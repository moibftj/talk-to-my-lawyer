# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ TALK-TO-MY-LAWYER - ENVIRONMENT VARIABLES CONFIGURATION                    │
# │                                                                             │
# │ IMPORTANT: Copy this file to .env.local and fill in your actual values     │
# │ NEVER commit .env.local or any file containing actual secrets!            │
# └─────────────────────────────────────────────────────────────────────────────┘

# ============================================================================
# CRITICAL VARIABLES (Required for all environments)
# ============================================================================

# Supabase Configuration
# Get these from your Supabase project settings > API
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here

# Supabase hostname (for Next.js image optimization, extracted from URL if not provided)
# Format: db-project-ref.supabase.co
SUPABASE_HOSTNAME=db-your-project-ref.supabase.co

# OpenAI Configuration
# Get your API key from https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-openai-api-key-here

# ============================================================================
# PRODUCTION VARIABLES (Required for production deployment)
# ============================================================================

# Supabase Service Role Key (server-only, never expose to client)
# Get from Supabase project settings > API > service_role (secret)
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# Stripe Configuration
# Get keys from https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key
# Server-side Stripe publishable key (used by lib/config/env.ts)
STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key
# Webhook secret from Stripe > Developers > Webhooks > your endpoint
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Admin Configuration
ADMIN_EMAIL=admin@yourdomain.com
# Admin password for scripts like scripts/create-admin-user.ts
ADMIN_PASSWORD=your-strong-admin-password
# Random string for admin portal authentication (min 32 chars recommended)
ADMIN_PORTAL_KEY=your-random-admin-portal-key-min-32-chars
# Custom route prefix for the admin portal (default: secure-admin-gateway)
# ADMIN_PORTAL_ROUTE=secure-admin-gateway

# Security Secrets (Required for production)
# Secret for CSRF token generation and validation
# Generate with: openssl rand -hex 32
CSRF_SECRET=your-random-csrf-secret-min-32-chars
# Secret for signing admin session JWTs (falls back to CSRF_SECRET if not set)
# Generate with: openssl rand -hex 32
ADMIN_SESSION_SECRET=your-random-admin-session-secret-min-32-chars

# Cron Job Security
# Random string for cron job authentication
CRON_SECRET=your-random-cron-secret-key

# Production Site URL
# Used for email links, callbacks, and redirects
NEXT_PUBLIC_SITE_URL=https://yourdomain.com

# ============================================================================
# EMAIL CONFIGURATION (At least one provider required for production)
# ============================================================================

# Resend (Recommended - https://resend.com)
# Get API key from https://resend.com/api-keys
RESEND_API_KEY=re_your-resend-api-key

# Email From Address
# Must be a verified domain in your email provider
EMAIL_FROM=noreply@yourdomain.com

# Email From Name (optional)
EMAIL_FROM_NAME=Talk-To-My-Lawyer

# Reply-To Address (optional, strongly recommended for deliverability)
# Use a real, monitored email address to improve inbox placement
EMAIL_REPLY_TO=support@yourdomain.com

# Email provider (optional, defaults to 'resend')
# EMAIL_PROVIDER=resend

# Supabase Auth Hook Secret (for custom email sending via /api/auth/send-email)
# Required in production for signature verification of Supabase auth webhooks
# Get from Supabase Dashboard > Authentication > Hooks
SUPABASE_AUTH_HOOK_SECRET=your-supabase-auth-hook-secret

# ============================================================================
# RATE LIMITING CONFIGURATION (Strongly recommended for production)
# ============================================================================

# Upstash Redis (https://upstash.com)
# Create a Redis database and get the REST API credentials
# Used by @upstash/redis for rate limiting via REST API
KV_REST_API_URL=https://your-redis-instance.upstash.io
KV_REST_API_TOKEN=your-upstash-redis-token

# ============================================================================
# n8n WORKFLOW INTEGRATION (Required - for AI letter generation)
# ============================================================================
# n8n is the automation platform used for letter generation and PDF workflows.
# The n8n workflow handles: jurisdiction research, letter generation via GPT-4o,
# and direct Supabase updates with the generated content.
#
# Setup:
# 1. Deploy n8n (self-hosted or n8n.cloud)
# 2. Import the letter generation workflow
# 3. Activate the workflow and copy the webhook URL
# 4. Set the variables below

# Letter Generation Webhook URL (REQUIRED for letter generation)
# This is the primary webhook that triggers AI letter generation
# Example: https://your-n8n-instance.app.n8n.cloud/webhook/letter-generation
N8N_WEBHOOK_URL=https://your-n8n-instance.app.n8n.cloud/webhook/your-webhook-id

# n8n Webhook Basic Authentication (Recommended for production)
# Username and password for Basic Auth (configured in n8n workflow)
# These credentials are Base64-encoded and sent in the Authorization header
N8N_WEBHOOK_AUTH_USER=your-n8n-webhook-username
N8N_WEBHOOK_AUTH_PASSWORD=your-n8n-webhook-password

# n8n Workflow Integration
# Webhook URL for letter generation via n8n (PRIMARY generation method)
# Get this from your n8n workflow webhook settings
N8N_WEBHOOK_URL=

# PDF generation service (uses same Basic Auth credentials)
N8N_PDF_WEBHOOK_URL=

# Supabase credentials for n8n to directly access the database
N8N_SUPABASE_URL=
N8N_SUPABASE_SERVICE_KEY=

# ============================================================================
# OPTIONAL VARIABLES
# ============================================================================

# Application URL (Legacy - use NEXT_PUBLIC_SITE_URL instead)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Test Mode (server-side)
# WARNING: MUST be set to "false" in production!
# When true, bypasses payment verification and other checks
ENABLE_TEST_MODE=false

# Test Mode (client-side)
# WARNING: MUST be set to "false" in production!
# Controls visibility of test mode UI indicators
NEXT_PUBLIC_TEST_MODE=false

# Test Account Utilities (scripts/create-test-accounts*.js/ts)
TEST_ACCOUNT_PASSWORD=your-strong-test-password

# Logging Configuration (optional)
# Set log level: debug, info, warn, error (default: info in prod, debug in dev)
# LOG_LEVEL=info
# Set to "json" for structured JSON log output (useful in production)
# LOG_FORMAT=json

# AI Gateway API Key (optional - for AI gateway health monitoring)
# AI_GATEWAY_API_KEY=your-ai-gateway-api-key

# ============================================================================
# VERCEL DEPLOYMENT NOTES
# ============================================================================
# This project is optimized for Vercel deployment.
#
# Required steps:
# 1. Go to Project Settings > Environment Variables
# 2. Add all variables above that are NOT commented out
# 3. Use "Sensitive" type for secrets (SUPABASE_SERVICE_ROLE_KEY, STRIPE_SECRET_KEY,
#    ADMIN_PORTAL_KEY, CRON_SECRET, CSRF_SECRET, ADMIN_SESSION_SECRET,
#    N8N_WEBHOOK_AUTH_KEY, RESEND_API_KEY, etc.)
# 4. Public variables (NEXT_PUBLIC_*) can be added as plain text
# 5. Set ENABLE_TEST_MODE and NEXT_PUBLIC_TEST_MODE to "false" for Production
# 6. Configure different values for Preview/Production/Development environments
#
# Vercel auto-provides these variables (do NOT set manually):
#   VERCEL, VERCEL_ENV, VERCEL_URL, VERCEL_GIT_COMMIT_SHA
#
# Cron jobs are configured in vercel.json and require CRON_SECRET.
# Function timeouts are configured in vercel.json (up to 120s for cron routes).

# Security Best Practices:
# 1. Rotate secrets regularly (quarterly for production)
# 2. Use different keys for development/staging/production
# 3. Never log environment variable values in error messages
# 4. Restrict access to secrets to minimum required team members
# 5. Use Vercel's "Sensitive" type for all secret variables
# 6. Enable audit logging for secrets access

# ============================================================================
# VALIDATION
# ============================================================================
# Run `pnpm validate-env` to check your configuration before deployment

# ============================================================================
# LEGAL RESEARCH API (Optional - for enhanced letter generation)
# ============================================================================

# Tavily API (Recommended - optimized for AI/research)
# Get your key from https://tavily.com
TAVILY_API_KEY=tvly-your-tavily-api-key

# Alternative: Bing Web Search API
# Get from Azure Cognitive Services
BING_SEARCH_API_KEY=your-bing-search-api-key

# ============================================================================
# OPENTELEMETRY TRACING (Optional)
# ============================================================================

# OTLP Exporter Endpoint for distributed tracing
# Default: http://localhost:4318/v1/traces (OTLP/HTTP)
# Use http://localhost:4317 for OTLP/gRPC
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces

# Optional: OTLP Headers (JSON format for authentication)
# OTEL_EXPORTER_OTLP_HEADERS='{"authorization":"Bearer YOUR_TOKEN"}'

# Optional: Service identification
# OTEL_SERVICE_NAME=talk-to-my-lawyer
# OTEL_SERVICE_VERSION=1.0.0

# Optional: Disable tracing completely
# OTEL_SDK_DISABLED=false

# ============================================================================
# SENTRY ERROR TRACKING (Recommended for production)
# ============================================================================

# Sentry DSN (Data Source Name)
# Get from Sentry → Settings → Projects → Your Project → Client Keys (DSN)
# Client DSN is for browser errors, server DSN is for API errors
NEXT_PUBLIC_SENTRY_DSN=https://your-client-dsn@sentry.io/project-id
SENTRY_DSN=https://your-server-dsn@sentry.io/project-id

# Sentry Release
# Automatically uses Vercel git SHA in production, or can be set manually
# Useful for linking errors to specific deployments
SENTRY_RELEASE=local

# Sentry Debug Mode
# Set to "true" to enable verbose Sentry logging in development
# SENTRY_DEBUG=false

# ============================================================================
# MCP SERVER CONFIGURATION (For AI/CLI integration only - not needed for Vercel)
# ============================================================================

# GitHub Integration
# Get token from https://github.com/settings/tokens
# Requires repo + read:user scopes minimum
GITHUB_TOKEN=ghp_your-github-personal-access-token

# Vercel Integration
# Get token from https://vercel.com/account/tokens
VERCEL_TOKEN=your-vercel-token
VERCEL_TEAM_ID=your-vercel-team-id

# Database URL (for direct MCP Postgres access)
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://user:password@host:5432/postgres

# Optional: Supabase DB connection (deploy-migrations.sh)
SUPABASE_DB_HOST=aws-1-us-east-2.pooler.supabase.com
SUPABASE_DB_USER=postgres.your-project-ref
SUPABASE_DB_NAME=postgres
SUPABASE_DB_PORT=6543
SUPABASE_DB_PASSWORD=your-db-password
